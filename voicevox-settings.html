<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POTA Notification - 読み上げ設定</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
      margin-bottom: 20px;
      color: #333;
    }

    .field-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #fafafa;
    }

    .field-section h2 {
      margin-bottom: 15px;
      color: #555;
      font-size: 18px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
      font-weight: 500;
      color: #333;
    }

    .form-group input[type="text"],
    .form-group input[type="number"],
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
      font-family: inherit;
    }

    .form-group input[type="text"]:focus,
    .form-group input[type="number"]:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #007bff;
    }

    .form-row {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    .form-row .form-group {
      flex: 1;
      margin-bottom: 0;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .checkbox-group label {
      margin: 0;
      cursor: pointer;
      font-size: 14px;
    }

    .slider-container {
      margin-bottom: 20px;
    }

    .slider-label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .slider-label .number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background-color: #dc3545;
      color: white;
      font-size: 12px;
      font-weight: bold;
    }

    .slider-label .text {
      font-size: 14px;
      font-weight: 500;
      color: #333;
    }

    .slider-wrapper {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .slider {
      flex: 1;
      height: 6px;
      border-radius: 3px;
      background: linear-gradient(to right, #007bff 0%, #007bff var(--value, 33%), #e0e0e0 var(--value, 33%), #e0e0e0 100%);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #007bff;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #007bff;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .slider-value {
      min-width: 50px;
      text-align: right;
      font-size: 14px;
      color: #666;
    }

    .btn-refresh {
      padding: 8px 16px;
      background: #17a2b8;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-refresh:hover {
      background: #138496;
    }

    .btn-test {
      padding: 8px 16px;
      background: #17a2b8;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 10px;
    }

    .btn-test:hover {
      background: #138496;
    }

    .buttons {
      margin-top: 30px;
      text-align: right;
      padding-top: 20px;
      border-top: 1px solid #ddd;
    }

    .btn-save, .btn-cancel {
      padding: 10px 20px;
      margin-left: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-save {
      background: #007bff;
      color: white;
    }

    .btn-save:hover {
      background: #0056b3;
    }

    .btn-cancel {
      background: #6c757d;
      color: white;
    }

    .btn-cancel:hover {
      background: #5a6268;
    }

    .error-message {
      color: #dc3545;
      font-size: 12px;
      margin-top: 5px;
    }

    code {
      background-color: #f5f5f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #d63384;
    }

    .loading {
      color: #666;
      font-size: 12px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>POTA Notification - 読み上げ設定</h1>

    <!-- VOICEVOX Engine設定 -->
    <div class="field-section">
      <h2>VOICEVOX Engine設定</h2>
      <div class="form-group">
        <label>ホスト名:</label>
        <input type="text" id="voicevox-hostname" placeholder="localhost" />
      </div>
      <div class="form-group">
        <label>ポート番号:</label>
        <input type="number" id="voicevox-port" placeholder="50021" min="1" max="65535" />
      </div>
      <div class="form-group">
        <label>話者:</label>
        <div style="display: flex; gap: 10px; align-items: center;">
          <select id="voicevox-speaker" style="flex: 1;">
            <option value="">話者を読み込み中...</option>
          </select>
          <button class="btn-refresh" onclick="refreshSpeakers()">更新</button>
        </div>
        <div id="speaker-loading" class="loading" style="display: none;">話者一覧を取得中...</div>
        <div id="speaker-error" class="error-message" style="display: none;"></div>
      </div>
      <div style="margin-top: 15px;">
        <button class="btn-test" onclick="testConnection()" style="margin-top: 0;">接続テスト</button>
        <p style="font-size: 12px; color: #666; margin-top: 8px;">
          VOICEVOX Engineへの接続をテストします。
        </p>
      </div>
    </div>

    <!-- 読み上げ設定 -->
    <div class="field-section">
      <h2>読み上げ設定</h2>
      <div class="form-group">
        <label>読み上げ内容:</label>
        <textarea id="voicevox-template" placeholder="[reference] [frequency] [mode] [activator] [comments]"></textarea>
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
          読み上げる内容を変数を使って定義できます。<br>
          使用可能な変数: <code>[reference]</code>, <code>[frequency]</code>, <code>[mode]</code>, <code>[activator]</code>, <code>[comments]</code>, <code>[name]</code>, <code>[locationDesc]</code><br>
          例: <code>[reference] [frequency] [mode] [activator] [comments]</code>
        </p>
      </div>
      <div class="form-group" style="margin-top: 15px;">
        <label>1回で読み上げるSpot数:</label>
        <input 
          type="number" 
          id="voicevox-max-spots"
          min="0"
          value="0"
          style="width: 200px; padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;"
        />
        <p style="font-size: 12px; color: #666; margin-top: 5px;">
          0を指定すると全てのSpotを読み上げます。1以上を指定すると、その数まで読み上げます。
        </p>
      </div>
      <div class="checkbox-group" style="margin-top: 15px;">
        <input type="checkbox" id="voicevox-mhz" />
        <label for="voicevox-mhz">MHzで読み上げる</label>
      </div>
      <p style="font-size: 12px; color: #666; margin-top: 5px;">
        チェックを外すと周波数をキロヘルツで読み上げます。
      </p>
      <div class="checkbox-group" style="margin-top: 15px;">
        <input type="checkbox" id="voicevox-portable" />
        <label for="voicevox-portable">コールサインの/はポータブルと読む</label>
      </div>
      <p style="font-size: 12px; color: #666; margin-top: 5px;">
        チェックを入れると、spotterのコールサインに含まれる「/」を「ポータブル」に置換して読み上げます。
      </p>
      <div class="checkbox-group" style="margin-top: 15px;">
        <input type="checkbox" id="voicevox-number-english" />
        <label for="voicevox-number-english">コールサインの数字は英語読みする</label>
      </div>
      <p style="font-size: 12px; color: #666; margin-top: 5px;">
        チェックを入れると、コールサインに含まれる数字（0-9）を英語読み（ゼロ、ワン、ツー...）に置換して読み上げます。
      </p>
      <div style="margin-top: 15px;">
      <button class="btn-test" onclick="testVoicevox()">テスト読み上げ</button>
        <p style="font-size: 12px; color: #666; margin-top: 8px;">
          現在の読み上げ内容テンプレートを使って、実際のスポットデータ形式でテスト読み上げを行います。<br>
          テストデータ: JP-1001, 7144kHz, SSB, JK1AZT/8, ssb, Akkeshi-Kiritappu-Konbumori Quasi-National Park, JP-HK
        </p>
      </div>
    </div>

    <!-- 読み上げパラメータ -->
    <div class="field-section">
      <h2>読み上げパラメータ</h2>
      
      <div class="slider-container">
        <div class="slider-label">
          <span class="text">読み上げボリューム</span>
        </div>
        <div class="slider-wrapper">
          <input type="range" class="slider" id="param-volume" min="0" max="2" step="0.01" value="1.0" />
          <span class="slider-value" id="param-volume-value">1.00</span>
        </div>
      </div>

      <div class="slider-container">
        <div class="slider-label">
          <span class="text">読み上げ速度</span>
        </div>
        <div class="slider-wrapper">
          <input type="range" class="slider" id="param-speed" min="0.5" max="2" step="0.01" value="1.0" />
          <span class="slider-value" id="param-speed-value">1.00</span>
        </div>
      </div>

      <div class="slider-container">
        <div class="slider-label">
          <span class="text">読み上げピッチ</span>
        </div>
        <div class="slider-wrapper">
          <input type="range" class="slider" id="param-pitch" min="-0.15" max="0.15" step="0.01" value="0.0" />
          <span class="slider-value" id="param-pitch-value">0.00</span>
        </div>
      </div>

      <div class="slider-container">
        <div class="slider-label">
          <span class="text">イントネーション</span>
        </div>
        <div class="slider-wrapper">
          <input type="range" class="slider" id="param-intonation" min="0" max="2" step="0.01" value="1.0" />
          <span class="slider-value" id="param-intonation-value">1.00</span>
        </div>
      </div>

      <div class="slider-container">
        <div class="slider-label">
          <span class="text">息継ぎ</span>
        </div>
        <div class="slider-wrapper">
          <input type="range" class="slider" id="param-breathing" min="0" max="1" step="0.01" value="0.0" />
          <span class="slider-value" id="param-breathing-value">0.00</span>
        </div>
      </div>
    </div>


    <div class="buttons">
      <button class="btn-save" onclick="saveSettings()">保存</button>
      <button class="btn-cancel" onclick="closeSettings()">キャンセル</button>
    </div>
  </div>

  <script src="voicevox-settings.js"></script>
</body>
</html>

